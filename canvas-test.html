<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Screenshot Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        .canvas-container {
            border: 2px solid #ddd;
            margin: 20px 0;
            display: inline-block;
            background: #000;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .result {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .success {
            border-left-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .thumbnail-preview {
            margin: 10px 0;
            border: 2px solid #28a745;
            display: inline-block;
            background: white;
            padding: 5px;
        }
        
        .log {
            background: #f1f3f4;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Canvas Screenshot Test</h1>
        <p>This test checks if we can capture screenshots from a canvas element.</p>
        
        <div class="canvas-container">
            <canvas id="testCanvas" width="800" height="400"></canvas>
        </div>
        
        <div class="controls">
            <button onclick="drawTestContent()">1. Draw Test Content</button>
            <button onclick="takeScreenshot()">2. Take Screenshot</button>
            <button onclick="testThumbnailGeneration()">3. Generate Thumbnail</button>
            <button onclick="testDataURLSave()">4. Test Data URL Save</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <div id="results"></div>
        <div id="log" class="log"></div>
    </div>

    <script>
        // Logging system
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : 'üîç';
            logDiv.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            resultsDiv.appendChild(div);
        }
        
        function clearLog() {
            document.getElementById('log').textContent = '';
            document.getElementById('results').innerHTML = '';
        }
        
        // Test functions
        function drawTestContent() {
            log('Drawing test content to canvas...');
            
            try {
                const canvas = document.getElementById('testCanvas');
                const ctx = canvas.getContext('2d');
                
                if (!ctx) {
                    throw new Error('Could not get 2D context');
                }
                
                // Clear canvas
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw background gradient
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#2c3e50');
                gradient.addColorStop(1, '#34495e');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw title
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Welcome to Wix', canvas.width / 2, 150);
                
                // Draw subtitle
                ctx.fillStyle = '#ecf0f1';
                ctx.font = '24px Arial';
                ctx.fillText('Create Amazing Videos', canvas.width / 2, 200);
                
                // Draw some shapes
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(200, 300, 30, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#3498db';
                ctx.fillRect(300, 270, 60, 60);
                
                ctx.fillStyle = '#2ecc71';
                ctx.beginPath();
                ctx.moveTo(500, 270);
                ctx.lineTo(530, 330);
                ctx.lineTo(470, 330);
                ctx.closePath();
                ctx.fill();
                
                log('Test content drawn successfully', 'success');
                showResult('‚úÖ Test content drawn to canvas', 'success');
                
            } catch (error) {
                log(`Failed to draw test content: ${error.message}`, 'error');
                showResult(`‚ùå Failed to draw test content: ${error.message}`, 'error');
            }
        }
        
        function takeScreenshot() {
            log('Taking screenshot of canvas...');
            
            try {
                const canvas = document.getElementById('testCanvas');
                
                // Test basic canvas access
                log(`Canvas dimensions: ${canvas.width}x${canvas.height}`);
                log(`Canvas nodeName: ${canvas.nodeName}`);
                log(`Canvas has getContext: ${typeof canvas.getContext === 'function'}`);
                
                // Get data URL
                const dataURL = canvas.toDataURL('image/png');
                log(`Screenshot data URL length: ${dataURL.length} characters`);
                log(`Screenshot size: ${Math.round(dataURL.length / 1024)}KB`);
                
                if (dataURL.length < 100) {
                    throw new Error('Data URL too short - canvas might be empty');
                }
                
                // Display the screenshot
                const img = document.createElement('img');
                img.src = dataURL;
                img.style.maxWidth = '400px';
                img.style.border = '2px solid #28a745';
                img.style.margin = '10px';
                
                const resultHtml = `
                    ‚úÖ Screenshot captured successfully!<br>
                    üìä Size: ${Math.round(dataURL.length / 1024)}KB<br>
                    üñºÔ∏è Preview:<br>
                    ${img.outerHTML}
                `;
                
                showResult(resultHtml, 'success');
                log('Screenshot captured and displayed successfully', 'success');
                
                return dataURL;
                
            } catch (error) {
                log(`Screenshot failed: ${error.message}`, 'error');
                showResult(`‚ùå Screenshot failed: ${error.message}`, 'error');
                return null;
            }
        }
        
        function testThumbnailGeneration() {
            log('Testing thumbnail generation...');
            
            try {
                const canvas = document.getElementById('testCanvas');
                
                // Create thumbnail canvas
                const thumbCanvas = document.createElement('canvas');
                thumbCanvas.width = 350;
                thumbCanvas.height = 200;
                const thumbCtx = thumbCanvas.getContext('2d');
                
                if (!thumbCtx) {
                    throw new Error('Could not get thumbnail canvas context');
                }
                
                log(`Thumbnail canvas created: ${thumbCanvas.width}x${thumbCanvas.height}`);
                
                // Draw original canvas to thumbnail canvas (scaled down)
                thumbCtx.drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, thumbCanvas.width, thumbCanvas.height);
                log('Image drawn to thumbnail canvas');
                
                // Convert to data URL
                const thumbnailDataURL = thumbCanvas.toDataURL('image/jpeg', 0.8);
                log(`Thumbnail data URL length: ${thumbnailDataURL.length} characters`);
                log(`Thumbnail size: ${Math.round(thumbnailDataURL.length / 1024)}KB`);
                
                if (thumbnailDataURL.length < 100) {
                    throw new Error('Thumbnail data URL too short');
                }
                
                // Display the thumbnail
                const img = document.createElement('img');
                img.src = thumbnailDataURL;
                img.style.maxWidth = '200px';
                img.style.border = '2px solid #007bff';
                img.style.margin = '10px';
                
                const resultHtml = `
                    ‚úÖ Thumbnail generated successfully!<br>
                    üìä Size: ${Math.round(thumbnailDataURL.length / 1024)}KB (JPEG 80% quality)<br>
                    üìê Dimensions: 350x200px<br>
                    üñºÔ∏è Preview:<br>
                    ${img.outerHTML}
                `;
                
                showResult(resultHtml, 'success');
                log('Thumbnail generated and displayed successfully', 'success');
                
                return thumbnailDataURL;
                
            } catch (error) {
                log(`Thumbnail generation failed: ${error.message}`, 'error');
                showResult(`‚ùå Thumbnail generation failed: ${error.message}`, 'error');
                return null;
            }
        }
        
        function testDataURLSave() {
            log('Testing data URL save to localStorage...');
            
            try {
                const thumbnaxil = testThumbnailGeneration();
                
                if (!thumbnail) {
                    throw new Error('No thumbnail to save');
                }
                
                // Test localStorage save
                const testKey = 'canvas_test_thumbnail';
                log(`Saving to localStorage with key: ${testKey}`);
                
                localStorage.setItem(testKey, thumbnail);
                log('Data saved to localStorage');
                
                // Verify save
                const retrieved = localStorage.getItem(testKey);
                if (!retrieved) {
                    throw new Error('Failed to retrieve saved data');
                }
                
                log(`Retrieved data length: ${retrieved.length} characters`);
                
                if (retrieved.length !== thumbnail.length) {
                    throw new Error(`Data length mismatch: saved ${thumbnail.length}, retrieved ${retrieved.length}`);
                }
                
                log('Data integrity verified');
                
                // Test creating image from saved data
                const testImg = document.createElement('img');
                testImg.src = retrieved;
                testImg.style.maxWidth = '150px';
                testImg.style.border = '2px solid #ffc107';
                testImg.style.margin = '10px';
                
                const resultHtml = `
                    ‚úÖ Data URL save test successful!<br>
                    üíæ Saved to localStorage: ${Math.round(thumbnail.length / 1024)}KB<br>
                    ‚úÖ Data integrity verified<br>
                    üñºÔ∏è Loaded from storage:<br>
                    ${testImg.outerHTML}
                `;
                
                showResult(resultHtml, 'success');
                log('Data URL save test completed successfully', 'success');
                
                // Clean up
                localStorage.removeItem(testKey);
                log('Test data cleaned up from localStorage');
                
            } catch (error) {
                log(`Data URL save test failed: ${error.message}`, 'error');
                showResult(`‚ùå Data URL save test failed: ${error.message}`, 'error');
            }
        }
        
        // Initialize
        log('Canvas screenshot test loaded');
        log('Click "1. Draw Test Content" to start');
    </script>
</body>
</html> 